<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>wern.chat!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #0b81ff;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
        }
        
        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        #app {
            width: 100%;
            max-width: 450px;
            height: 95vh;
            background: white;
            border-radius: 28px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* –≠–ö–†–ê–ù –í–•–û–î–ê */
        #loginScreen {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 25px 20px;
            background: white;
        }
        
        .logo {
            text-align: center;
            margin: 30px 0 40px 0;
        }
        
        .logo h1 {
            font-size: 42px;
            margin-bottom: 10px;
        }
        
        .logo p {
            color: #666;
            font-size: 16px;
        }
        
        .input-field {
            margin-bottom: 20px;
        }
        
        .input-field label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            margin-left: 5px;
        }
        
        .input-field input {
            width: 100%;
            padding: 18px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 30px;
            background: #f8f9fa;
            transition: all 0.2s;
        }
        
        .input-field input:focus {
            outline: none;
            border-color: #0b81ff;
            background: white;
        }
        
        .join-btn {
            width: 100%;
            padding: 18px;
            background: #0b81ff;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(11,129,255,0.3);
            transition: transform 0.1s;
        }
        
        .join-btn:active {
            transform: scale(0.98);
            background: #0a74e6;
        }
        
        /* –≠–ö–†–ê–ù –ß–ê–¢–ê */
        #chatScreen {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #f0f2f5;
            display: none;
        }
        
        /* –®–∞–ø–∫–∞ —á–∞—Ç–∞ */
        .chat-header {
            background: #0b81ff;
            color: white;
            padding: 15px 15px 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .room-info {
            display: flex;
            flex-direction: column;
        }
        
        .room-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .people-count {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .exit-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: background 0.2s;
        }
        
        .exit-btn:active {
            background: rgba(255,255,255,0.3);
        }
        
        /* –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .users-bar {
            background: white;
            padding: 12px 15px;
            overflow-x: auto;
            white-space: nowrap;
            border-bottom: 1px solid #e0e0e0;
            -webkit-overflow-scrolling: touch;
        }
        
        .user-tag {
            display: inline-block;
            background: #f0f2f5;
            color: #333;
            padding: 8px 16px;
            border-radius: 25px;
            margin-right: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .user-tag:last-child {
            margin-right: 0;
        }
        
        /* –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: #f0f2f5;
        }
        
        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 22px;
            font-size: 15px;
            line-height: 1.4;
            word-wrap: break-word;
            animation: fadeIn 0.2s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-other {
            align-self: flex-start;
            background: white;
            border-bottom-left-radius: 5px;
            color: #000;
        }
        
        .message-mine {
            align-self: flex-end;
            background: #0b81ff;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message-header {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .message-mine .message-header {
            color: rgba(255,255,255,0.9);
        }
        
        .message-other .message-header {
            color: #0b81ff;
        }
        
        .system-message {
            text-align: center;
            color: #666;
            font-size: 13px;
            margin: 8px 0;
            font-style: italic;
            background: rgba(0,0,0,0.03);
            padding: 6px 12px;
            border-radius: 20px;
            align-self: center;
        }
        
        /* –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ */
        .input-panel {
            background: white;
            padding: 12px 15px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #e0e0e0;
            align-items: center;
        }
        
        .input-panel input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 30px;
            font-size: 15px;
            background: #f8f9fa;
        }
        
        .input-panel input:focus {
            outline: none;
            border-color: #0b81ff;
            background: white;
        }
        
        .send-btn {
            width: 55px;
            height: 55px;
            border-radius: 30px;
            background: #0b81ff;
            color: white;
            border: none;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(11,129,255,0.3);
            transition: transform 0.1s;
        }
        
        .send-btn:active {
            transform: scale(0.95);
        }
        
        .send-btn span {
            transform: rotate(90deg);
            font-size: 24px;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            z-index: 1000;
            animation: slideDown 0.3s;
            max-width: 90%;
            text-align: center;
        }
        
        @keyframes slideDown {
            from { top: -50px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #0b81ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-height: 600px) {
            .logo { margin: 15px 0 25px 0; }
            .logo h1 { font-size: 36px; }
            .input-field { margin-bottom: 15px; }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
        <div id="loginScreen">
            <div class="logo">
                <h1>üí¨ –ß–∞—Ç</h1>
                <p>–î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>
            </div>
            
            <div class="input-field">
                <label>–¢–≤–æ—ë –∏–º—è</label>
                <input type="text" id="username" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω—è" autocomplete="off" value="">
            </div>
            
            <div class="input-field">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã</label>
                <input type="text" id="room" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥—Ä—É–∑—å—è" autocomplete="off" value="">
            </div>
            
            <button class="join-btn" onclick="joinRoom()">
                ‚û§ –í–æ–π—Ç–∏ –≤ —á–∞—Ç
            </button>
            
            <div style="text-align: center; margin-top: 25px; color: #999; font-size: 13px;">
                üë• –¥–æ 20 —á–µ–ª–æ–≤–µ–∫ –≤ –∫–æ–º–Ω–∞—Ç–µ
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ -->
        <div id="chatScreen">
            <div class="chat-header">
                <div class="room-info">
                    <span class="room-name" id="currentRoom">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    <span class="people-count" id="peopleCount">0/20</span>
                </div>
                <button class="exit-btn" onclick="leaveRoom()">
                    ‚úï –í—ã–π—Ç–∏
                </button>
            </div>
            
            <div class="users-bar" id="usersList">
                <span class="user-tag">üë• –ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            
            <div class="messages-area" id="messages"></div>
            
            <div class="input-panel">
                <input type="text" id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                <button class="send-btn" onclick="sendMessage()">
                    <span>‚û§</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        const MAX_USERS = 20;
        const STORAGE_KEY = 'mobile_chat_data';
        
        // ========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentUser = '';
        let currentRoom = '';
        let lastMessageTime = 0;
        let updateInterval = null;
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê/–°–û–•–†–ê–ù–ï–ù–ò–ï ==========
        function loadData() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : { rooms: {} };
        }
        
        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }
        
        // ========== –í–•–û–î –í –ö–û–ú–ù–ê–¢–£ ==========
        function joinRoom() {
            const username = document.getElementById('username').value.trim();
            const room = document.getElementById('room').value.trim();
            
            if (!username || !room) {
                showNotification('–í–≤–µ–¥–∏ –∏–º—è –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã!');
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const data = loadData();
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–º–Ω–∞—Ç—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
            if (!data.rooms[room]) {
                data.rooms[room] = {
                    users: [],
                    messages: []
                };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π
            if (data.rooms[room].users.length >= MAX_USERS) {
                showNotification('–ö–æ–º–Ω–∞—Ç–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞! –ú–∞–∫—Å. ' + MAX_USERS + ' —á–µ–ª–æ–≤–µ–∫');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–æ –ª–∏ –∏–º—è
            if (data.rooms[room].users.includes(username)) {
                showNotification('–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ –≤ –∫–æ–º–Ω–∞—Ç–µ!');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            data.rooms[room].users.push(username);
            saveData(data);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            currentUser = username;
            currentRoom = room;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            addSystemMessageToRoom(room, 'üëã ' + username + ' –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —á–∞—Ç—É');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —á–∞—Ç–∞
            showChatScreen();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            startUpdating();
        }
        
        // ========== –í–´–•–û–î –ò–ó –ö–û–ú–ù–ê–¢–´ ==========
        function leaveRoom() {
            if (!currentRoom || !currentUser) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã—Ö–æ–¥–µ
            addSystemMessageToRoom(currentRoom, 'üëã ' + currentUser + ' –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç');
            
            // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
            const data = loadData();
            if (data.rooms[currentRoom]) {
                data.rooms[currentRoom].users = data.rooms[currentRoom].users.filter(u => u !== currentUser);
                
                // –ï—Å–ª–∏ –∫–æ–º–Ω–∞—Ç–∞ –ø—É—Å—Ç–∞ - —É–¥–∞–ª—è–µ–º –µ—ë
                if (data.rooms[currentRoom].users.length === 0) {
                    delete data.rooms[currentRoom];
                }
                
                saveData(data);
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            stopUpdating();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
            document.getElementById('chatScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('username').value = currentUser;
            document.getElementById('room').value = currentRoom;
            
            currentUser = '';
            currentRoom = '';
        }
        
        // ========== –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø ==========
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentRoom || !currentUser) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const data = loadData();
            if (data.rooms[currentRoom]) {
                data.rooms[currentRoom].messages.push({
                    type: 'message',
                    user: currentUser,
                    text: text,
                    time: Date.now()
                });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                if (data.rooms[currentRoom].messages.length > 100) {
                    data.rooms[currentRoom].messages = data.rooms[currentRoom].messages.slice(-100);
                }
                
                saveData(data);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É
                displayMessage({
                    type: 'message',
                    user: currentUser,
                    text: text
                }, true);
                
                input.value = '';
                lastMessageTime = Date.now();
            }
        }
        
        // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –°–ò–°–¢–ï–ú–ù–û–ì–û –°–û–û–ë–©–ï–ù–ò–Ø ==========
        function addSystemMessageToRoom(room, text) {
            const data = loadData();
            if (data.rooms[room]) {
                if (!data.rooms[room].messages) data.rooms[room].messages = [];
                
                data.rooms[room].messages.push({
                    type: 'system',
                    text: text,
                    time: Date.now()
                });
                
                saveData(data);
            }
        }
        
        // ========== –ü–û–ö–ê–ó –≠–ö–†–ê–ù–ê –ß–ê–¢–ê ==========
        function showChatScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('chatScreen').style.display = 'flex';
            document.getElementById('currentRoom').textContent = currentRoom;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            updateDisplay();
        }
        
        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê ==========
        function updateDisplay() {
            if (!currentRoom) return;
            
            const data = loadData();
            const room = data.rooms[currentRoom];
            
            if (!room) {
                // –ö–æ–º–Ω–∞—Ç–∞ –∏—Å—á–µ–∑–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ –≤—ã—à–ª–∏)
                leaveRoom();
                showNotification('–ö–æ–º–Ω–∞—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π
            document.getElementById('peopleCount').textContent = room.users.length + '/' + MAX_USERS;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            let usersHtml = '';
            room.users.forEach(user => {
                usersHtml += `<span class="user-tag">üë§ ${user}</span>`;
            });
            
            if (room.users.length === 0) {
                usersHtml = '<span class="user-tag">üë• –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>';
            }
            
            document.getElementById('usersList').innerHTML = usersHtml;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            const messagesContainer = document.getElementById('messages');
            const shouldScroll = messagesContainer.scrollHeight - messagesContainer.scrollTop < 50;
            
            // –û—á–∏—â–∞–µ–º –∏ –∑–∞–Ω–æ–≤–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            messagesContainer.innerHTML = '';
            room.messages.forEach(msg => {
                displayMessage(msg, msg.user === currentUser);
            });
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (shouldScroll) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }
        
        // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–Ø ==========
        function displayMessage(msg, isMine) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            
            if (msg.type === 'system') {
                messageDiv.className = 'system-message';
                messageDiv.textContent = msg.text;
            } else {
                messageDiv.className = 'message ' + (isMine ? 'message-mine' : 'message-other');
                messageDiv.innerHTML = `
                    <div class="message-header">${msg.user}</div>
                    <div>${msg.text}</div>
                `;
            }
            
            messagesDiv.appendChild(messageDiv);
        }
        
        // ========== –ó–ê–ü–£–°–ö –û–ë–ù–û–í–õ–ï–ù–ò–Ø ==========
        function startUpdating() {
            updateDisplay();
            updateInterval = setInterval(updateDisplay, 1000);
        }
        
        function stopUpdating() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateI